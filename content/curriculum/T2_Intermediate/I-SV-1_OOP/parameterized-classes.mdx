import { InfoPage } from "@/components/templates/InfoPage";
import { Quiz, InteractiveCode, InterviewQuestionPlayground } from "@/components/ui";

export const metadata = {
  title:
    "Parameterized Classes and Abstract Classes | Advanced SystemVerilog for Verification",
  description:
    "Use generics and abstract classes to build reusable components while avoiding common pitfalls.",
};

<InfoPage
  title="Parameterized Classes and Abstract Classes"
  sv_concept_tags={["parameterized classes", "abstract classes"]}
>

  ## Parameterized (Generic) Classes
  *IEEE 1800-2023, Clause 8.25: Parameterized classes*

  Parameterized classes let one definition handle many data types or sizes. A
  parameter can represent a type or a value, making components highly reusable.

  <InteractiveCode>
  ```systemverilog
  // Generic FIFO, parameterized by type T and depth D
  class fifo #(type T = int, int D = 4);
    T mem[D];
    int wptr = 0;

    function void push(T value);
      mem[wptr++] = value;
    endfunction
  endclass

  // Instantiate FIFO for bytes
  fifo #(byte, 8) byte_fifo = new();
  ```
  </InteractiveCode>

  ## Abstract Classes
  *IEEE 1800-2023, Clause 8.20: Virtual methods*

  A class with a `pure virtual` method or declared with the `virtual` keyword is
  abstract and cannot be instantiated. It serves as a template that derived
  classes must complete.

  <InteractiveCode>
  ```systemverilog
  virtual class driver;
    pure virtual task run(); // makes the class abstract
  endclass

  class my_driver extends driver;
    task run();
      $display("running");
    endtask
  endclass

  program demo;
    initial begin
      driver d;          // handle to abstract class
      // d = new();      // illegal: driver is abstract
      d = new my_driver();
      d.run();
    end
  endprogram
  ```
  </InteractiveCode>

  ## Common Pitfalls

  - Omitting default values makes instantiations verbose and error-prone.
  - Parameter mismatches can introduce subtle type bugs.
  - Forgetting to implement a `pure virtual` method prevents compilation.
  - Attempting to instantiate an abstract class results in an error.

  ## Quiz

  <Quiz questions={[
    {
      "question": "What keyword marks a class as abstract in SystemVerilog?",
      "answers": [
        {"text": "abstract", "correct": false},
        {"text": "virtual", "correct": true},
        {"text": "pure", "correct": false},
        {"text": "generic", "correct": false}
      ],
      "explanation": "Prepending 'virtual' to a class declaration makes it abstract."
    }
  ]} />

  <div className="mt-8">
    <InterviewQuestionPlayground
      question="A junior engineer writes `storage s;` where `storage` is a parameterized class `class storage #(type T = int);`. Does this compile, and if so, what is the type of `s`?"
      options={[
        { text: "It fails to compile because type parameters must always be explicitly provided.", isCorrect: false, feedback: "If default parameters are provided in the class definition, they can be omitted." },
        { text: "It compiles, but `s` defaults to an untyped generic handle until assigned.", isCorrect: false, feedback: "SystemVerilog handles must have a resolved type." },
        { text: "It fails to compile. To use default parameters, you must write `storage #() s;`.", isCorrect: true, feedback: "Correct! Even if default parameters exist, SystemVerilog requires the `#()` syntax to indicate parameter specialization. Writing `storage s;` is a syntax error." },
        { text: "It compiles and `s` is of type `storage #(int)`.", isCorrect: false, feedback: "Though logical, SystemVerilog syntax explicitly requires the empty specialization `#()` to apply default parameters." }
      ]}
    />
  </div>

</InfoPage>

