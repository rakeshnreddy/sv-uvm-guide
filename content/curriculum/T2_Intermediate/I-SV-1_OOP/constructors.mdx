import { InfoPage } from "@/components/templates/InfoPage";
import { Quiz, InteractiveCode, InterviewQuestionPlayground } from "@/components/ui";

export const metadata = {
  title: "Constructors, 'this', and 'super' | Advanced SystemVerilog for Verification",
  description:
    "How to create objects with new and reference parent and current class members using this and super.",
};

<InfoPage
  title="Constructors, 'this', and 'super'"
  sv_concept_tags={["constructors", "this", "super"]}
>

  ## Constructors
  *IEEE 1800-2023, Clause 8.15: Object initialization*

  SystemVerilog uses the `new` function as a constructor to create and initialize
  class objects. Constructors can accept arguments, letting you configure an
  object at creation time.

  <InteractiveCode>
  ```systemverilog
  class Packet;
    int addr;
    int data;

    // Constructor with arguments
    function new(int addr = 0, int data = 0);
      this.addr = addr;
      this.data = data;
    endfunction
  endclass

  program demo;
    initial begin
      Packet p = new(16'h10, 8'hFF); // calls Packet::new
      $display("addr=%0h data=%0h", p.addr, p.data);
    end
  endprogram
  ```
  </InteractiveCode>

  ## Using `this`

  The `this` keyword refers to the current object. It disambiguates between
  member variables and constructor arguments or local variables with the same
  name.

  ## Calling the Parent with `super`

  When a class extends another, its constructor can invoke the parent
  constructor using `super.new()`. The same keyword allows a method to call the
  overridden version in the parent.

  <InteractiveCode>
  ```systemverilog
  class Base;
    int id;
    function new(int id);
      this.id = id;
    endfunction
    function void print();
      $display("Base id=%0d", id);
    endfunction
  endclass

  class Child extends Base;
    string name;
    function new(int id, string name);
      super.new(id); // call Base constructor
      this.name = name;
    endfunction
    function void print();
      super.print(); // call Base::print
      $display("  Child name=%s", name);
    endfunction
  endclass

  program demo;
    initial begin
      Child c = new(1, "pkt");
      c.print();
    end
  endprogram
  ```
  </InteractiveCode>

  ## Common Pitfalls

  - Forgetting to call `super.new()` leaves base-class members uninitialized.
  - Using `this` on a null handle causes a runtime error.

  ## Quiz

  <Quiz questions={[
    {
      "question": "Which keyword refers to the current instance of a class?",
      "answers": [
        {"text": "self", "correct": false},
        {"text": "this", "correct": true},
        {"text": "super", "correct": false},
        {"text": "current", "correct": false}
      ],
      "explanation": "`this` lets you access members of the current object."
    }
  ]} />

  <div className="mt-8">
    <InterviewQuestionPlayground
      question="What happens if a child class constructor does not explicitly call `super.new()`?"
      options={[
        { text: "The base class members keep default initialization.", isCorrect: false, feedback: "Default initialization without running the base constructor can still mean some setup is bypassed." },
        { text: "The code fails to compile.", isCorrect: false, feedback: "It will actually compile under certain conditions, but the simulator's behavior is very specific." },
        { text: "The simulator implicitly calls `super.new()` without arguments as the first statement.", isCorrect: true, feedback: "Correct! The simulator automatically calls `super.new()` if you don't. However, if the base class constructor requires arguments and has no default values, the compilation WILL fail." },
        { text: "The base class constructor is skipped entirely.", isCorrect: false, feedback: "SystemVerilog guarantees base constructors are called." }
      ]}
    />
  </div>

</InfoPage>

