import { InfoPage } from "@/components/templates/InfoPage";
import { Quiz, InteractiveCode } from "@/components/ui";

export const metadata = {
  title: "Semaphores | Advanced SystemVerilog for Verification",
  description: "Control access to shared resources using semaphore keys.",
};

<InfoPage
  title="Semaphores"
  sv_concept_tags={["semaphores"]}
>

  ## Level 1: The Big Idea

  A **semaphore** is like a set of keys. Processes must take a key (`get`) before using a shared resource and return it (`put`) when done. If no keys are available, the process waits.

  ## Level 2: Practical Usage

  ### Getting and Putting Keys

  -   `semaphore sem = new(1);` creates a semaphore with one key.
  -   `sem.get(1);` acquires a key (blocks if none are free).
  -   `sem.put(1);` releases a key.
  -   `sem.try_get(1);` attempts to get a key without blocking.

  <InteractiveCode>
  ```systemverilog
  semaphore bus_sem = new(1);

  task master(string name);
    bus_sem.get(1);        // wait for access
    $display("%s using bus at %0t", name, $time);
    #10;
    bus_sem.put(1);        // release
  endtask

  initial begin
    fork
      master("A");
      master("B");
    join
  end
  ```
  </InteractiveCode>

  ## Level 3: Expert Insights

  **Resource Pools:** Use semaphores with more than one key to model pools like DMA channels or memory ports.

  **Fairness:** Combining `try_get` with random delays can prevent starvation in heavily contended systems.

  **Coordinating Random Stimulus:** When multiple threads generate randomized transactions, semaphores ensure only a safe number run concurrently. For more on stimulus generation, revisit [Constrained Randomization](/curriculum/T2_Intermediate/I-SV-2_Constrained_Randomization).

  ## Quiz

  <Quiz questions={[
    {
      question: "What happens if `sem.get(2)` is called when only one key is available?",
      answers: [
        { text: "The call blocks until two keys are available", correct: true },
        { text: "One key is returned immediately", correct: false },
        { text: "An error is thrown", correct: false },
        { text: "The semaphore is reset", correct: false }
      ],
      explanation: "`get` waits until the requested number of keys can be obtained."
    },
    {
      question: "Which method acquires a semaphore key without blocking?",
      answers: [
        { text: "`get`", correct: false },
        { text: "`put`", correct: false },
        { text: "`try_get`", correct: true },
        { text: "`wait`", correct: false }
      ],
      explanation: "`try_get` attempts to get keys and returns immediately if none are available."
    }
  ]} />

</InfoPage>

