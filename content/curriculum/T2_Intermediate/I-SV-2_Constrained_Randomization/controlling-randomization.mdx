import { InfoPage } from "@/components/templates/InfoPage";
import InteractiveCode from "@/components/ui/InteractiveCode";
import Quiz from "@/components/ui/Quiz";

export const metadata = {
  title: "Controlling Randomization: pre_randomize and post_randomize | Advanced SystemVerilog for Verification",
  description: "...",
};

<InfoPage
  title="Controlling Randomization: pre_randomize and post_randomize"
  sv_concept_tags={["pre_randomize", "post_randomize"]}
>

## Level 1: Hooking the Solver

**The Analogy:** `pre_randomize` sets the table before guests arrive; `post_randomize` checks the dishes after the meal.

## Level 2: Core Mechanics

<InteractiveCode language="systemverilog" code={`class frame;
  rand bit [7:0] len;
  rand bit [7:0] payload[];

  function void pre_randomize();
    // Clear existing payload before generating new values
    payload.delete();
  endfunction

  function void post_randomize();
    // Allocate payload after len is known
    payload = new[len];
    foreach (payload[i]) payload[i] = i;
  endfunction
endclass

program test;
  frame f = new();
  initial begin
    repeat (2) begin
      assert(f.randomize());
      $display("len=%0d payload=%p", f.len, f.payload);
    end
  end
endprogram`} />

## Level 3: Expert Tips

- Use `pre_randomize` to enable/disable constraints with `constraint_mode(0)` or to set up dynamic arrays.
- Keep work in `post_randomize` lightweight; heavy processing can impact simulation time.

<Quiz questions={[
  {
    question: "When is `pre_randomize` executed?",
    answers: [
      { text: "After new values are generated", correct: false },
      { text: "Immediately before the solver runs", correct: true },
      { text: "Only at time 0", correct: false }
    ],
    explanation: "`pre_randomize` gives you a chance to prepare the object before solving."
  },
  {
    question: "What is a common use of `post_randomize`?",
    answers: [
      { text: "Changing constraints", correct: false },
      { text: "Filling derived fields based on randomized values", correct: true },
      { text: "Resetting random variables", correct: false }
    ],
    explanation: "`post_randomize` reacts to the results of randomization, such as allocating arrays or computing checksums."
  }
]} />

</InfoPage>
