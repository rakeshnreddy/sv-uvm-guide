import { InfoPage } from "@/components/templates/InfoPage";
import InteractiveCode from "@/components/ui/InteractiveCode";
import Quiz from "@/components/ui/Quiz";

export const metadata = {
  title: "Constraint Blocks, soft, and solve...before | Advanced SystemVerilog for Verification",
  description: "Control dependencies and defaults using constraint blocks, soft values, and solve-before ordering.",
};

<InfoPage
  title="Constraint Blocks, soft, and solve...before"
  sv_concept_tags={["constraint blocks", "soft", "solve...before"]}
>

## Level 1: Defaults and Dependencies

**The Analogy:** A constraint block is like a set of road signs guiding traffic. A `soft` sign is a suggestion that can be overridden, and `solve...before` sets the order of the traffic lights.

## Level 2: Core Mechanics

### Basic Constraint Block

<InteractiveCode language="systemverilog" code={`class addr_range;
  rand bit [7:0] low, high;
  constraint c_order { low < high; }
endclass`} />

### Soft Constraints

<InteractiveCode language="systemverilog" code={`class cfg;
  rand bit [7:0] timeout;
  constraint c_default { soft timeout == 8'd16; }
endclass

program test;
  cfg c = new();
  initial begin
    c.randomize();
    $display("timeout=%0d", c.timeout); // uses soft default
    c.randomize() with { timeout == 8'd4; }; // override default
    $display("timeout=%0d", c.timeout);
  end
endprogram`} />

### Ordering with `solve...before`

<InteractiveCode language="systemverilog" code={`class packet;
  rand int size;
  rand bit [7:0] data[];
  constraint c_order { solve size before data; data.size() == size; }
endclass`} />

## Level 3: Expert Tips

- `soft` gives a fallback value but disappears when a stronger constraint is present.
- Overusing `solve...before` can slow the solver; use it only when a variable's legal range depends on another's value.

<Quiz questions={[
  {
    question: "What happens when an inline constraint sets `timeout` to 4 in the example?",
    answers: [
      { text: "Randomization fails", correct: false },
      { text: "The `soft` constraint is ignored", correct: true },
      { text: "Timeout stays at 16", correct: false }
    ],
    explanation: "A `soft` constraint acts as a default and is overridden by the inline constraint."
  },
  {
    question: "Why use `solve size before data`?",
    answers: [
      { text: "To randomize `data` first", correct: false },
      { text: "Because `data.size()` depends on `size`", correct: true },
      { text: "It speeds up randomization", correct: false }
    ],
    explanation: "The solver must know `size` before it can assign a consistent `data` array length."
  }
]} />

</InfoPage>
