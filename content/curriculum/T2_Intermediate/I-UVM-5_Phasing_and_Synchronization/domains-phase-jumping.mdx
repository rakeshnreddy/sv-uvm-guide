import { InfoPage } from "@/components/templates/InfoPage";
import { InteractiveCode, Quiz } from "@/components/ui";

export const metadata = {
  title: "Domains and Phase Jumping | The UVM Universe - Core Concepts",
  description: "...",
};

<InfoPage
  title="Domains and Phase Jumping"
  uvm_concept_tags={["domains", "phase jumping"]}
>

  ## Phase Domains

  Phases execute in a **domain**. The default *common* domain runs all components
  through the standard phase sequence. You can create additional domains to run
  a subset of components with their own phase schedule—for example, to keep a
  configuration agent alive after the rest of the environment has stopped.

  <InteractiveCode
    language="systemverilog"
    fileName="custom_domain_example.sv"
    code={`class cfg_agent extends uvm_agent;
  `uvm_component_utils(cfg_agent)
  // ...
endclass

class my_env extends uvm_env;
  `uvm_component_utils(my_env)
  cfg_agent cfg;
  function void build_phase(uvm_phase phase);
    super.build_phase(phase);
    cfg = cfg_agent::type_id::create("cfg", this);
    uvm_domain cfg_dom = new("cfg_dom");
    cfg.set_domain(cfg_dom); // cfg runs in its own domain
  endfunction
endclass`}
  />

  ## Phase Jumping

  UVM allows components to **jump** to another phase. This is rarely used but can
  be helpful to skip remaining runtime phases when a stopping condition is met.

  <InteractiveCode
    language="systemverilog"
    fileName="phase_jump_example.sv"
    code={`task run_phase(uvm_phase phase);
  if(stop_simulation)
    phase.jump(uvm_shutdown_phase::get());
endtask`}
  />

  ## Level 3: Expert Notes

  - A phase jump only affects components within the same domain; other domains
    continue their schedules.
  - Use jumps sparingly—skipping cleanup phases can leave files open or threads
    running.
  - Pair domain-specific components with synchronization primitives like
    <Link href="/curriculum/T2_Intermediate/I-UVM-5_Phasing_and_Synchronization/uvm-event-barrier">`uvm_event`</Link>
    to coordinate cross-domain actions.

  ## Check Your Understanding

  <Quiz
    questions={[
      {
        question:
          "Why create a custom phase domain for a configuration agent?",
        answers: [
          { text: "To randomize data faster", correct: false },
          {
            text: "To let it run a different phase schedule than the rest of the environment",
            correct: true,
          },
          { text: "To disable the UVM factory", correct: false },
          { text: "To avoid using objections", correct: false },
        ],
        explanation:
          "Custom domains let selected components execute independent phase sequences.",
      },
      {
        question: "What risk comes with jumping directly to `uvm_shutdown_phase`?",
        answers: [
          {
            text: "Pending cleanup in later phases might be skipped",
            correct: true,
          },
          { text: "Other domains will also jump automatically", correct: false },
          { text: "The simulation time resets to zero", correct: false },
          { text: "The factory overrides are lost", correct: false },
        ],
        explanation:
          "Jumping phases bypasses remaining scheduled phases for that domain, so cleanup code may not run.",
      },
    ]}
  />

</InfoPage>